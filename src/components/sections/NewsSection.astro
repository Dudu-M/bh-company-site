---
import { getCollection } from 'astro:content';
import Button from '../ui/Button.astro';
import { Calendar } from 'lucide-astro';

interface Props {
  limit?: number;
  showButton?: boolean;
  class?: string;
}

const { limit = 3, showButton = true, class: className = '' } = Astro.props;

// Get all news, sorted by date
const allNews = await getCollection('news');
const sortedNews = allNews
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, limit);

// Format date
const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('en-US', {
    month: 'long',
    day: 'numeric',
    year: 'numeric'
  }).format(date);
};
---

<section class={`section-spacing bg-white ${className}`}>
  <div class="container-custom">
    
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-end md:justify-between mb-12 gap-6">
      <div class="slide-up">
        <p class="text-accent-500 font-semibold text-lg mb-3 uppercase tracking-wide">
          Updates News
        </p>
        <h2 class="text-primary-500">
          Latest News & Updates
        </h2>
      </div>
      
      {showButton && (
        <div class="slide-up slide-up-delay-1">
          <Button 
            href="/news" 
            variant="primary"
            size="md"
            class="!rounded-full"
          >
            View All News
          </Button>
        </div>
      )}
    </div>

    <!-- News Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      {sortedNews.map((article, index) => (
        <a 
          href={`/news/${article.slug}`}
          class="group slide-up"
          style={`animation-delay: ${index * 0.1}s`}
        >
          <article class="bg-neutral-50 rounded-2xl overflow-hidden h-full transition-all duration-300 hover:shadow-xl hover:-translate-y-2">
            
            <!-- Image -->
            <div class="relative h-64 overflow-hidden">
              <img 
                src={article.data.image} 
                alt={article.data.title}
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
              />
            </div>

            <!-- Content -->
            <div class="p-6">
              <!-- Date -->
              <div class="flex items-center gap-2 text-neutral-500 text-sm mb-3">
                <Calendar class="w-4 h-4" />
                <time datetime={article.data.date.toISOString()}>
                  {formatDate(article.data.date)}
                </time>
              </div>

              <!-- Title -->
              <h4 class="text-xl font-semibold text-primary-500 mb-3 group-hover:text-accent-500 transition-colors line-clamp-2">
                {article.data.title}
              </h4>

              <!-- Excerpt -->
              <p class="text-neutral-600 line-clamp-3">
                {article.data.excerpt}
              </p>
            </div>

          </article>
        </a>
      ))}
    </div>

  </div>
</section>